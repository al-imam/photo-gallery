generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  USER
  MODERATOR
  ADMIN
}

enum MediaStatus {
  PENDING
  APPROVED
  REJECTED
  PASSED_TO_ADMIN
}

model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  name          String
  avatar        String?
  role          UserRole @default(USER)
  username      String   @unique @default(cuid())
  hasBeenBanned Boolean  @default(false)

  email          String   @unique
  password       String
  authModifiedAt DateTime @default(now())

  media          Media[]         @relation("User")
  approved_media Media[]         @relation("Media")
  bookmarks      BookMark[]      @relation("Bookmark")
  notifications  Notification[]  @relation("Notification")
  NONE_REACTIONS MediaReaction[] @relation("MediaReaction")
}

model Media {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  messageId String

  title       String   @default("")
  description String   @default("")
  tags        String[]
  note        String?

  newCategory String?
  categoryId  String?
  category    MediaCategory? @relation("MediaCategory", fields: [categoryId], references: [id])

  media_size              Int
  media_width             Int
  media_height            Int
  media_hasGraphicContent Boolean @default(false)

  url_media     String
  url_thumbnail String

  authorId String
  author   User   @relation("User", fields: [authorId], references: [id])

  status               MediaStatus @default(PENDING)
  status_moderatedById String?
  status_moderatedBy   User?       @relation("Media", fields: [status_moderatedById], references: [id])
  status_moderatedAt   DateTime?
  status_approvedAt    DateTime?

  NONE_BOOKMARK  BookMark[]      @relation("Bookmark")
  NONE_REACTIONS MediaReaction[] @relation("MediaReaction")
}

model MediaReaction {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  mediaId String
  media   Media  @relation("MediaReaction", fields: [mediaId], references: [id])

  userId String
  user   User   @relation("MediaReaction", fields: [userId], references: [id])

  @@unique([mediaId, userId])
}

model MediaCategory {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  media     Media[]  @relation("MediaCategory")
}

model BookMark {
  id      String @id @default(uuid())
  mediaId String
  userId  String

  NONE_MEDIA Media @relation("Bookmark", fields: [mediaId], references: [id])
  NONE_USER  User  @relation("Bookmark", fields: [userId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  userId String
  user   User   @relation("Notification", fields: [userId], references: [id])

  message String
  read    Boolean @default(false)
}
